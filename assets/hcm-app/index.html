<!DOCTYPE html>
<html>
<head>
  <title>HCM Integrator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>


  <div id="root"></div>
  <script type="text/babel">
        const { useMemo, useState, useEffect } = React;

    // --- Minimal in-browser PoC for your GitHub Pages ---
    // One-file React app that:
    // 1) Lists a small catalog of Home‑Cage Monitoring (HCM) systems
    // 2) Shows which ontology facets (HCMO, MBO, MRPO) each system touches
    // 3) Displays example datasets & behavior derivations per system
    // 4) Surfaces JSON‑LD for transparency & future extension
    // Tailwind classes are used for quick, clean styling.

    // ----------------------
    // Static Ontology Facets (MBO, MRPO)
    // ----------------------
    const ONTO_MBO = {
      id: "MBO",
      label: "Mouse Behavior Ontology",
      behaviors: [
        { id: "inactive", label: "Inactive" },
        { id: "walk", label: "Walking" },
        { id: "run", label: "Running" },
        { id: "turn", label: "Turning" },
      ],
    };

    const ONTO_MRPO = {
      id: "MRPO",
      label: "Metadata in Preclinical Research Ontology",
      fields: [
        { id: "project.title", label: "Project Title" },
        { id: "species", label: "Species" },
        { id: "strain", label: "Strain" },
        { id: "n", label: "N (per group)" },
        { id: "protocol_id", label: "Protocol ID" },
        { id: "startAt", label: "Start Date" },
      ],
    };

    // ---------------------------------
    // Mapping: sensors → derivable MBO
    // ---------------------------------
    const SENSOR_TO_BEHAVIORS = {
      pir: ["inactive", "walk"],
      loadcell: ["inactive", "walk", "run"],
      rfid: ["inactive"],
      video: ["inactive", "walk", "run", "turn"],
      ir: [], // illumination helper, not directly deriving behavior
      mic: [], // placeholder
    };

    // Utility: compute union of behaviors derivable from a sensor set
    function behaviorsFromSensors(sensors) {
      const set = new Set();
      sensors.forEach((s) => SENSOR_TO_BEHAVIORS[s]?.forEach((b) => set.add(b)));
      return Array.from(set);
    }

    function Section({ title, children }) {
      return (
        <div className="mb-6">
          <div className="text-lg font-semibold mb-2">{title}</div>
          <div className="rounded-2xl border p-3 shadow-sm bg-white">{children}</div>
        </div>
      );
    }

    function Badge({ label, active }) {
      return (
        <span
          className={`inline-block px-2 py-1 mr-2 mb-2 rounded-full text-xs border ${
            active ? "bg-black text-white border-black" : "bg-gray-50 text-gray-700 border-gray-200"
          }`}
        >
          {label}
        </span>
      );
    }

    function JSONBlock({ obj }) {
      return (
        <pre className="text-xs bg-gray-50 rounded-xl p-3 overflow-auto max-h-64">
          {JSON.stringify(obj, null, 2)}
        </pre>
      );
    }

    function App() {
      const [catalog, setCatalog] = useState([]);
      const [selectedId, setSelectedId] = useState(null);

      useEffect(() => {
        fetch('./systems.json')
          .then(response => response.json())
          .then(data => {
            setCatalog(data);
            if (data.length > 0) {
              setSelectedId(data[0].id);
            }
          })
          .catch(error => console.error("Failed to load systems.json", error));
      }, []);

      const selected = useMemo(
        () => catalog.find((c) => c.id === selectedId),
        [selectedId, catalog]
      );

      // The MBO section needs a list of sensor *types* (e.g., 'video', 'rfid')
      const activeSensorTypes = useMemo(() => selected?.hasHardware.hasSensor.map(s => s.sensorType) ?? [], [selected]);
      const unionBehaviors = useMemo(() => behaviorsFromSensors(activeSensorTypes), [activeSensorTypes]);
      const datasets = useMemo(() => selected?.datasets ?? [], [selected]);

      if (!catalog.length || !selected) {
        return <div>Loading...</div>;
      }
      
      const dims = selected.hasEnclosure.hasPhysicalSpace.hasDimensions;

      return (
        <div className="min-h-screen w-full bg-gray-100 p-6">
          <div className="max-w-6xl mx-auto">
                  
      
            <header className="mb-6">
              <h1 className="text-2xl font-bold">HCM Integrator · Minimal PoC</h1>
              <p className="text-sm text-gray-600">
                Static React app designed for GitHub Pages. Select a system to see which ontology facets are covered
                and what behaviors/datasets become available.
              </p>
            </header>

            <header>
                    <p>Disclaimer: this is an experimental app! Created only as a proof of concept.</p>
            </header>

            {/* Catalog selector */}
            <Section title="Catalog · Select a System">
              <div className="flex flex-wrap items-center gap-2">
                {catalog.map((item) => {
                  const active = selectedId === item.id;
                  return (
                    <button
                      key={item.id}
                      className={`px-3 py-2 rounded-2xl border-2 text-sm shadow-sm transition ${
                        active ? `bg-black text-white ${item.color}` : `bg-white hover:bg-gray-50 ${item.color}`
                      }`}
                      onClick={() => setSelectedId(item.id)}
                    >
                      <div className="font-medium">{item.name}</div>
                      <div className="text-xs opacity-75">{item.vendor}</div>
                    </button>
                  );
                })}
              </div>
            </Section>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* HCMO Facets */}
              <Section title="HCMO · System Architecture">
                <div className="space-y-3 text-sm">
                  <div>
                    <div className="font-semibold">Enclosure</div>
                    <div className="pl-4 border-l-2">
                      <div>{selected.hasEnclosure.label}</div>
                      <div className="text-xs text-gray-500">
                        {dims.width}{dims.unitText} x {dims.length}{dims.unitText} x {dims.height}{dims.unitText}
                      </div>
                    </div>
                  </div>
                  <div>
                    <div className="font-semibold">Hardware</div>
                    <div className="pl-4 border-l-2">
                      <div>{selected.hasHardware.label}</div>
                      <div className="font-medium mt-2">Sensors:</div>
                      <ul className="list-disc list-inside pl-4">
                        {selected.hasHardware.hasSensor.map(s => <li key={s.id}>{s.label} <span className="text-gray-500">({s.sensorType})</span></li>)}
                      </ul>
                      {selected.hasHardware.hasActuator.length > 0 && (
                        <>
                          <div className="font-medium mt-2">Actuators:</div>
                          <ul className="list-disc list-inside pl-4">
                            {selected.hasHardware.hasActuator.map(a => <li key={a.id}>{a.label}</li>)}
                          </ul>
                        </>
                      )}
                    </div>
                  </div>
                  <div>
                    <div className="font-semibold">Software</div>
                     <div className="pl-4 border-l-2">
                      <div>{selected.hasSoftware.label} v{selected.hasSoftware.softwareVersion}</div>
                    </div>
                  </div>
                </div>
              </Section>

              {/* MBO Behaviors */}
              <Section title="MBO · Behaviors Enabled by Selected Sensors">
                <div>
                  {ONTO_MBO.behaviors.map((b) => (
                    <Badge key={b.id} label={b.label} active={unionBehaviors.includes(b.id)} />
                  ))}
                </div>
              </Section>

              {/* MRPO Fields */}
              <Section title="MRPO · Project Metadata Fields (filled in examples)">
                <div className="text-sm text-gray-600 mb-3">
                  Shown fields are commonly required. Switch systems to see example projects.
                </div>
                <div className="space-y-3">
                    <div className="rounded-xl border p-3 bg-white">
                      <div className="text-sm font-semibold mb-1">{selected.name}</div>
                      <div>
                        {ONTO_MRPO.fields.map((f) => (
                          <div key={f.id} className="flex items-center text-xs mb-1">
                            <span className="w-40 text-gray-500">{f.label}</span>
                            <span className="font-mono truncate">{(selected.project)[f.id] ?? "—"}</span>
                          </div>
                        ))}
                      </div>
                    </div>
                </div>
              </Section>
            </div>

            {/* Datasets & Behavior Coverage */}
            <Section title="Derived Datasets & Coverage">
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                {datasets.map((ds) => (
                  <div key={ds.id} className="rounded-xl border p-3 bg-white">
                    <div className="text-sm font-semibold mb-1">{ds.label}</div>
                    <div className="text-xs mb-2 text-gray-500">Behaviors in dataset</div>
                    <div>
                      {ONTO_MBO.behaviors.map((b) => (
                        <Badge key={b.id} label={b.label} active={ds.mbo.includes(b.id)} />
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </Section>

            {/* JSON-LD Transparency */}
            <Section title="JSON‑LD · Selected Projects">
                <div className="rounded-xl border p-3 bg-white">
                  <div className="text-sm font-semibold mb-2">{selected.name}</div>
                  <JSONBlock obj={selected.project} />
                </div>
            </Section>

            <footer className="text-xs text-gray-500 mt-8">
              Tip: Host this file as a static build on GitHub Pages (e.g., Vite + React). Replace sample data with your
              real JSON‑LD catalogs and MRPO shapes; wire in SHACL validation in‑browser if needed.
            </footer>
          </div>
        </div>
      );
    }

    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<App />);
  </script>
</body>
</html>